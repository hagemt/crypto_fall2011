/**
 * Copyright 2011 by Tor E. Hagemann <hagemt@rpi.edu>
 * This file is part of Plouton.
 *
 * Plouton is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Plouton is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Plouton.  If not, see <http://www.gnu.org/licenses/>.
 */

/* TODO Cmake-ify some more of these */
#ifndef LIBPLOUTON_H
#define LIBPLOUTON_H

/*
 * \brief Message section
 */

/* AAA messages */
#define BANKING_MSG_AUTH_CHECK "Are you still there?"
#define BANKING_MSG_AUTH_LOGIN "Welcome"

/* Prompt messages */
#define BANKING_MSG_PROMPT_SHELL "[banking] $ "
#define BANKING_MSG_PROMPT_PIN   "Enter PIN: "

/* TODO localization for BANKING_MSGs */

#define BANKING_PIN_ALICE "@BANKING_PIN_ALICE@"
#define BANKING_PIN_BOB   "@BANKING_PIN_BOB@"
#define BANKING_PIN_EVE   "@BANKING_PIN_EVE@"

/*
 * \brief Numeric section
 */

/* Important: BANKING_FAILURE is invalid file-descriptor */
#define BANKING_SUCCESS 0x00
#define BANKING_FAILURE (-1)

/* Important: AUTH_KEY_LENGTH <= MAX_COMMAND_LENGTH*/
#define BANKING_MAX_COMMAND_LENGTH 80
#define BANKING_MAX_CONNECTIONS     5
#define BANKING_MAX_TRANSACTION 10000

#define BANKING_VERSION_MAJOR @CMAKE_PROJECT_VERSION_MAJOR@
#define BANKING_VERSION_MINOR @CMAKE_PROJECT_VERSION_MINOR@

/* Important: AUTH_KEY_LENGTH <= MAX_COMMAND_LENGTH */
#define BANKING_AUTH_KEY_LENGTH   32 /* In bytes, so use 256-bit keys */
#define BANKING_AUTH_KEY_TIMEOUT 300 /* TTL in seconds of session keys */
#define BANKING_AUTH_SECMEM   0x7FFF /* 32KB of secmem stores 1024 keys */
#define BANKING_AUTH_SHMKEY   0xABBA /* "You are a dancing queen" */

/* Numeric port limits */
#define BANKING_PORT_MIN 0x0400 /*  1,024 */
#define BANKING_PORT_MAX 0xFFFF /* 65,535 */

/* Not strictly numeric, but w/e */
#define BANKING_ADDR_IPV4 "@BANKING_ADDR_IPV4@"
#define BANKING_ADDR_IPV6 "@BANKING_ADDR_IPV6@"

/*
 * \brief Database section
 */
#define BANKING_DB_TYPE "@BANKING_DB_TYPE@"
#define BANKING_DB_FILE \
	"@BANKING_DB_FILE@"

/* Static SQL query strings, fillable at $variables */
#define SQL_ACCOUNT_CREATE_TABLE \
	"CREATE TABLE accounts(name, pin, balance INTEGER);"
#define SQL_ACCOUNT_INSERT \
	"INSERT INTO accounts VALUES($name, $pin, $balance);"
#define SQL_ACCOUNT_SELECT_ALL \
	"SELECT name, pin, balance FROM accounts;"
#define SQL_ACCOUNT_SELECT_BALANCE \
	"SELECT balance FROM accounts WHERE name LIKE $name;"
#define SQL_ACCOUNT_SELECT_PIN \
	"SELECT pin FROM accounts WHERE name LIKE $name;"
#define SQL_ACCOUNT_UPDATE_BALANCE \
	"UPDATE accounts SET balance=$balance WHERE name LIKE $name;"

/* TODO move to source file? */

#include "libplouton/types.h"
#include "libplouton/crypto.h"
#include "libplouton/db.h"
#include "libplouton/shell.h"
#include "libplouton/socket.h"

#include <stdio.h>
void hexdump(FILE *, unsigned char *, size_t);

#endif /* LIBPLOUTON_H */
